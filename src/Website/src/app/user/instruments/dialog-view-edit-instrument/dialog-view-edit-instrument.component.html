<div *ngIf="instrumentView" class="dialog-view">
  <div class="flex flex-col justify-center">
    <div class="w-full">
      <app-editable-element
        [valueEl]="instrumentView.name"
        [action]="action"
        [minLength]="4"
        [maxLength]="100"
        (onChangeElement)="updateInstrumentField('name', $event, true)"
        class="font-semibold text-cyan-700 text-2xl"
      />
    </div>
    <!-- <p class="text-center"><span class="font-semibold text-cyan-700">{{ instrument.name }}</span></p> -->
    <div class="source-data mt-6">
      <p class="mb-0">
        <span class="text-slate-600 font-semibold">ID</span>:
        {{ instrumentView.id }}
      </p>

      <app-editable-element
        [keyEl]="'URL'"
        [valueEl]="instrumentView.url"
        [action]="action"
        [pattern]="
          '^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]+)(:[0-9]{1,5})?(\\/[^\\s]*)?$'
        "
        [minLength]="10"
        [maxLength]="100"
        (onChangeElement)="updateInstrumentField('url', $event, true)"
        class="merchant-element"
      />
      <!-- <p class="mb-0"><span class="text-slate-600 font-semibold">URL</span>: {{ instrument.url }}</p> -->
      <!-- <p class="mb-0"><span class="font-semibold">WOM generati</span>: Tanti</p> -->
    </div>
    <div class="mt-4">
      <p class="font-semibold mb-2">API Key:</p>
      <div class="flex items-center space-x-2">
        <input
          type="text"
          [(ngModel)]="newApiKeySelector"
          placeholder="Inserisci selettore per la nuova API Key"
          class="border rounded px-2 py-1 flex-1"
        />
        <button
          (click)="generateApiKey()"
          [disabled]="!newApiKeySelector"
          class="bg-cyan-700 text-white px-4 py-1 rounded hover:bg-cyan-800"
        >
          Genera
        </button>
      </div>
      <p *ngIf="generatedApiKey" class="mt-2 text-green-700 font-semibold">
        API Key: {{ generatedApiKey }}
      </p>
      <p *ngIf="apiKeyError" class="mt-2 text-red-600 font-semibold">
        Errore: {{ apiKeyError }}
      </p>
    </div>

    <app-aims-list [aimList]="instrumentView.aims" />

    <div *ngIf="action === 'edit'">
      <div class="mt-6">
        <app-user-aims-list
          [instrumentAims]="instrumentEditing.aims"
          (aimsEmit)="updateInstrumentField('aims', $event, false)"
        />
      </div>
    </div>
    <div class="mt-10">
      <p class="font-semibold mb-0">Gestori:</p>
      <app-access-list
        [accessList]="instrumentView.access"
        [action]="action"
        (deleteAccess)="confirmAndDeleteAccess($event)"
        (addAccess)="addAccessAndUpdateList($event)"
      />
    </div>
  </div>
</div>
